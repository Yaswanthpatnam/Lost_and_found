{% extends "base.html" %}
{% load static %}

{% block content %}

<h2>Search Lost and Found Items</h2>

<form method="get">

    <!-- Category Dropdown -->
    {{ form.category.label_tag }}
    {{ form.category }}

  <br> <br>


  <div class="form-group">
    <!-- Thing Name Input + Suggestions Box -->
    {{ form.thing_name.label_tag }}
    {{ form.thing_name }}
    <div class="suggestions-box" style="
        border: 1px solid #ccc;
        display: none;
        padding: 5px;
        max-height: 150px;
        overflow-y: auto;
    "></div>


    <!-- Location -->
    {{ form.location.label_tag }}
    {{ form.location }}

    <br><br>

    <!-- Date -->
    {{ form.date_time.label_tag }}
    {{ form.date_time }}
  </div>

  <br>
  <button type="submit">Search</button>
</form>

<hr>

{% if results %}
  <h3>Search Results:</h3>
  <ul>
    {% for item in results %}
      <li>
        <strong>{{ item.title }}</strong><br>
        Category: {{ item.category }}<br>
        Location: {{ item.location }}<br>
        {% if item.date_lost %}
          Lost On: {{ item.date_lost }}
        {% elif item.date_found %}
          Found On: {{ item.date_found }}
        {% endif %}
        <br>Contact: {{ item.contact_info }}
        <hr>
      </li>
    {% endfor %}
  </ul>
{% elif request.GET %}
  <p>No items found matching your search.</p>
{% endif %}

<!-- JS for Dynamic Suggestions -->
<script src="{% static 'js/category_Suggestions.js' %}"></script>
<script>
  // Expose category map globally for JS
  window.categoryMapData = {{ category_map_json|safe }};
  window.initializeCategorySuggestions(window.categoryMapData);
</script>

{% endblock %}
